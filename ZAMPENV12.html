<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ZAMPEN PRICE WATCH</title>
  <style>
    :root { --da-green: #0b6623; --light-yellow: #e0dba6; }
    body { margin: 0; font-family: Arial, sans-serif; background: #fff; }
    .top-strip { background-color: var(--da-green); height: 6px; width: 100%; }
    .yellow-strip { background-color: var(--light-yellow); height: 6px; width: 100%; }
    .header { display: flex; justify-content: space-between; align-items: center; background: white; padding: 15px 30px; }
    .header-left { display: flex; align-items: center; gap: 15px; }
    .header-left img { height: 60px; }
    .address { margin-left: 15px; color: #000; font-size: 14px; line-height: 1.4; }
    .address strong { font-size: 16px; }
    .header-right { display: flex; align-items: center; }
    .search-box input { padding: 6px 10px; border: 2px solid var(--da-green); border-radius: 4px 0 0 4px; outline: none; }
    .search-box button { padding: 6px 12px; border: 2px solid var(--da-green); background: var(--da-green); color: white; border-radius: 0 4px 4px 0; cursor: pointer; font-weight: bold; }
    .search-box input:focus, .search-box button:hover { box-shadow: 0 0 6px rgba(11,102,35,0.6); }
    .title-bar { background: var(--light-yellow); text-align: center; min-height: 44px; display: flex; align-items: center; justify-content: center; }
    .title-bar h1 { margin: 0; font-size: 22px; color: #000; font-weight: 900; letter-spacing: 1px; }
    .navbar { display: flex; justify-content: flex-end; align-items: center; background-color: var(--da-green); box-shadow: 0 2px 6px rgba(0,0,0,0.15); padding: 0 20px; min-height: 44px; position: relative; z-index: 1000; }
    .navbar button { background: var(--da-green); border: none; color: white; font-size: 13px; margin: 0 4px; cursor: pointer; padding: 6px 12px; border-radius: 4px; transition: background 0.18s; }
    .navbar button:hover { background: #228b22; }
    .navbar button.active { background: #228b22; }
    .submenu { display: none; position: absolute; background: var(--da-green); padding: 6px; border-radius: 6px; z-index: 9999; box-shadow: 0 6px 14px rgba(0,0,0,0.2); }
    .submenu button { display: block; width: 180px; margin: 4px 0; text-align: left; background: var(--da-green); border: none; padding: 6px 10px; color: white; cursor: pointer; }
    .submenu button:hover, .submenu button.active { background: #228b22; }
    .iframe-wrapper { width: 850px; height: 650px; overflow: hidden; position: relative; border: 1px solid var(--da-green); margin: 20px auto; z-index: 1; border-radius: 6px; display:none; }
    .iframe-wrapper iframe { position: absolute; top: -140px; left: -345px; width: 1200px; height: 900px; border: none; z-index: 1; }
    .footer-logo { display: flex; justify-content: flex-end; padding: 10px 30px 0 0; }
    .footer-logo img { height: 80px; }
    footer { background-color: var(--da-green); color: white; padding: 0 30px; min-height: 44px; display: flex; align-items: center; text-align: left; font-size: 14px; }
    .footer-left { font-size: 14px; font-style: italic; font-weight: bold; }
    .footer-left a { color: #fff; text-decoration: none; margin-right: 15px; }

    /* Home Page Styling */
    .section-title {
      background: var(--light-yellow);
      padding: 8px;
      text-align: center;
      font-size: 18px;
      font-weight: bold;
    }

    .main-grid { display: grid; grid-template-columns: 1fr 2fr; gap: 20px; margin: 20px; }
    .top-stories { border: 1px solid var(--da-green); border-radius: 6px; padding: 10px; }
    .top-stories h3 { background: var(--da-green); color: white; margin: -10px -10px 10px -10px; padding: 6px; border-radius: 6px 6px 0 0; }
    .top-stories ul { list-style: none; padding: 0; margin: 0; }
    .top-stories li { margin-bottom: 10px; font-size: 14px; }
    .amad-action { border: 1px solid var(--da-green); border-radius: 6px; padding: 10px; text-align: center; }
    .amad-action h3 { background: var(--da-green); color: white; margin: -10px -10px 10px -10px; padding: 6px; border-radius: 6px 6px 0 0; }
    .amad-action img { max-width: 100%; border-radius: 4px; margin-bottom: 10px; }

    @media (max-width: 900px) {
      .iframe-wrapper { width: 95%; height: 500px; }
      .header-left img { height: 48px; }
      .footer-logo img { height: 60px; }
      .main-grid { grid-template-columns: 1fr; }
      .carousel-item { min-width: 220px; max-width: 220px; }
    }
  </style>
</head>
<body>
  <div class="top-strip"></div>
  <div class="yellow-strip"></div>
  <div class="header">
    <div class="header-left">
      <img src="https://raw.githubusercontent.com/amadnuevedpi/DA-AMAD-BP-logos/main/bag%20pil.png" alt="Bagong Pilipinas">
      <img src="https://raw.githubusercontent.com/amadnuevedpi/DA-AMAD-BP-logos/main/da.png" alt="Department of Agriculture">
      <div class="address">
        <strong>Department of Agriculture</strong><br><strong>AGRIBUSINESS MARKETING ASSISTANCE DIVISION</strong><br> Regional Field Office IX<br> Lenienza St., Pagadian City
      </div>
    </div>
    <div class="header-right">
      <div class="search-box">
        <input type="text" placeholder="Search...">
        <button>üîç</button>
      </div>
    </div>
  </div>

  <div class="title-bar">
    <h1>ZAMPEN PRICE WATCH</h1>
  </div>

  <!-- Navbar -->
  <div class="navbar">
    <button onclick="setActive(this); loadReport('')" class="active">HOME</button>
    <button onclick="window.open('https://script.google.com/macros/s/AKfycbySxf-4RG-CjIPHuAnS6K-lq9gCiogm6Cf-1knA9bLIgl2rK4QdxOCii4WQ-836-KOD/exec','_blank')">UPDATE PRICES</button>
    <button id="priceStatsBtn" onclick="toggleSubmenu(event)">PRICE STATISTICS</button>
    <button onclick="setActive(this); loadDPI('https://docs.google.com/spreadsheets/d/e/2PACX-1vT61jbCC9Ufnduo2eIBWV9Lhx5j76r2T0XUrQv0v9jY59yKbEhnTz8g46MSLIkRR3L_iUkAlMFMG1dL/pubhtml?widget=false&chrome=false')">
  DAILY PRICE INDEX (DPI)
</button>
    <button onclick="setActive(this); loadReport('')">PRICE ADVISORY</button>
    <!-- Submenu -->
    <div id="submenu" class="submenu" aria-hidden="true">
      <button onclick="setSubActive(this); loadReport('https://lookerstudio.google.com/embed/reporting/4b4b037d-9610-4abb-8888-ffb8e8bbd4e4/page/p_pknflxucwd')">View Date</button>
      <button onclick="setSubActive(this); loadReport('https://lookerstudio.google.com/embed/reporting/4b4b037d-9610-4abb-8888-ffb8e8bbd4e4/page/p_kbvahx3cwd')">View Market</button>
      <button onclick="setSubActive(this); loadReport('https://lookerstudio.google.com/embed/reporting/4b4b037d-9610-4abb-8888-ffb8e8bbd4e4/page/p_pxqisx3cwd')">View Commodity</button>
    </div>
  </div>

  <!-- Home Content -->
  <div id="homeContent" class="home-content" style="display:block;">
 

  <!-- AMAD Ganap -->
<div class="amad-ganap">
  <h2 class="section-title">AMAD Ganap - Alamin at Monitor ang mga Aktibidad Dito</h2>
  <div class="carousel" id="carousel"></div>
</div>

<style>
  /* Carousel with auto scroll */
  .carousel {
    display: flex;
    gap: 15px;
    overflow-x: auto;
    padding: 10px;
    -webkit-overflow-scrolling: touch;
    scroll-behavior: smooth;
  }
  .carousel::-webkit-scrollbar {
    display: none;
  }
  .carousel-item {
    background: #f8f8f8;
    border: 1px solid #ddd;
    border-radius: 6px;
    min-width: 280px;
    max-width: 280px;
    text-align: center;
    padding: 0;
    display: flex;
    flex-direction: column;
    overflow: hidden;
    flex-shrink: 0;
  }
  .carousel-item img {
    width: 100%;
    height: 160px;
    object-fit: cover;
    display: block;
  }
  .carousel-item p {
    margin: 0;
    padding: 10px;
    font-size: 14px;
    background: #fff;
    flex: 0 0 auto;
  }
</style>

<script>
  const sheetUrl = "https://docs.google.com/spreadsheets/d/e/2PACX-1vRnaFFCj_G9ZdXKegDDsiIWXfv2JZUEfkNW6nEbhIiOMuLlfykrIMOuJ5gXDyAmFrIVv4WGViijMvNU/pub?gid=0&single=true&output=csv";

  function parseCSV(text) {
    const rows = [];
    let cur = '';
    let row = [];
    let inQuotes = false;
    for (let i = 0; i < text.length; i++) {
      const ch = text[i];
      if (inQuotes) {
        if (ch === '"') {
          if (text[i + 1] === '"') {
            cur += '"';
            i++;
          } else {
            inQuotes = false;
          }
        } else {
          cur += ch;
        }
      } else {
        if (ch === '"') {
          inQuotes = true;
        } else if (ch === ',') {
          row.push(cur);
          cur = '';
        } else if (ch === '\r') {
        } else if (ch === '\n') {
          row.push(cur);
          cur = '';
          rows.push(row);
          row = [];
        } else {
          cur += ch;
        }
      }
    }
    if (cur !== '' || row.length) {
      row.push(cur);
      rows.push(row);
    }
    return rows;
  }

  fetch(sheetUrl)
    .then(res => res.text())
    .then(csvText => {
      const parsed = parseCSV(csvText);
      const carousel = document.getElementById("carousel");
      carousel.innerHTML = "";

      // Loop all rows (starting from row 1 since no headers)
      parsed.forEach((row, i) => {
        const action = (row[1] || "").trim(); // Column B
        const imgUrl = (row[2] || "").trim(); // Column C

        if (!action) return; // skip blank rows

        const item = document.createElement("div");
        item.className = "carousel-item";

        const img = document.createElement("img");
        img.src = imgUrl || "https://via.placeholder.com/280x160";
        img.alt = action.substring(0, 60);

        const p = document.createElement("p");
        p.textContent = action;

        item.appendChild(img);
        item.appendChild(p);
        carousel.appendChild(item);
      });

      // Auto-scroll with pause on hover
      let scrollInterval;
      function startScroll() {
        scrollInterval = setInterval(() => {
          if (carousel.scrollWidth > carousel.clientWidth) {
            carousel.scrollLeft += 1;
            if (carousel.scrollLeft + carousel.clientWidth >= carousel.scrollWidth) {
              carousel.scrollLeft = 0; // loop
            }
          }
        }, 30);
      }
      function stopScroll() {
        clearInterval(scrollInterval);
      }
      carousel.addEventListener("mouseenter", stopScroll);
      carousel.addEventListener("mouseleave", startScroll);
      startScroll();
    })
    .catch(err => console.error("Error loading AMAD Ganap CSV:", err));
</script>

  <!-- Main Content Area -->
  <div class="main-grid">

    <!-- Top Stories -->
    <div class="top-stories">
      <h3>TOP STORIES</h3>
      <ul class="stories-list">
        <li>
          <strong>Training on Coco Coir Product Processing niadtong Septembre 15-16, 2025</strong><br>
          <small>September 15-16, 2025</small>
        </li>
        <li>
          <strong>ùó•ùó≤ùó¥ùó∂ùóºùóªùóÆùóπ ùóôùóøùòÇùó∂ùòÅ ùóÆùóªùó± ùó©ùó≤ùó¥ùó≤ùòÅùóÆùóØùóπùó≤ ùó£ùóøùóºùó∫ùóºùòÅùó∂ùóºùóª ùóÆùóªùó± ùóòùòÖùóΩùóºùòÄùó∂ùòÅùó∂ùóºùóª</strong><br>
          <small>September 23, 2025</small>
        </li>
        <li>
          <strong>Php84-M Cacao Processing & Marketing Enterprise of MIFAMCO</strong><br>
          <small>September 16, 2025</small>
        </li>
        <li>
          <strong>Training on Crafting of Project Proposal.</strong><br>
          <small>September 18-19, 2025</small>
        </li>
        <li>
          <strong>ùóóùó≤ùóΩùóÆùóøùòÅùó∫ùó≤ùóªùòÅ ùóºùó≥ ùóîùó¥ùóøùó∂ùó∞ùòÇùóπùòÅùòÇùóøùó≤‚Äìùóîùó†ùóîùóó ug sa ùó¢ùó≥ùó≥ùó∂ùó∞ùó≤ ùóºùó≥ ùòÅùóµùó≤ ùó£ùóøùóºùòÉùó∂ùóªùó∞ùó∂ùóÆùóπ ùóîùó¥ùóøùó∂ùó∞ùòÇùóπùòÅùòÇùóøùó∂ùòÄùòÅ, ang ùó£ùüÆùü¨ ùó•ùó∂ùó∞ùó≤ ùó£ùóøùóºùó∑ùó≤ùó∞ùòÅ</strong><br>
          <small>September 18, 2025</small>
        </li>
      </ul>
    </div>

    <!-- Featured AMAD Action -->
    <div class="amad-action">
      <h3>AMAD in ACTION</h3>
      <img src="https://raw.githubusercontent.com/amadnuevedpi/PICTURES/main/553584111_122212634918048874_4244468006856031363_n.jpg"
           alt="AMAD in Action" style="max-width:100%; border-radius:6px;">
      <p><strong>Regional Fruit and Vege</strong></p>
    </div>

  </div><!-- end main-grid -->

</div><!-- end homeContent -->


<style>
  /* Grid for Top Stories + AMAD Action */
  .main-grid {
    display: grid;
    grid-template-columns: 1fr 2fr; /* Top stories wider, AMAD action smaller */
    gap: 20px;
    margin-top: 20px;
  }

  @media (max-width: 768px) {
    .main-grid {
      grid-template-columns: 1fr; /* Stack on mobile */
    }
  }

  .stories-list {
    list-style: none;
    padding: 0;
    margin: 0;
  }

  .stories-list li {
    background: #f9f9f9;
    padding: 12px 16px;
    margin-bottom: 10px;
    border-radius: 6px;
    box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    transition: all 0.2s ease-in-out;
    cursor: pointer;
  }

  .stories-list li:hover {
    background: #e6f4ea;
    transform: translateY(-2px);
    box-shadow: 0 4px 8px rgba(0,0,0,0.15);
  }

  .stories-list strong {
    display: block;
    margin-bottom: 4px;
  }

  .stories-list small {
    color: #666;
    font-size: 0.9em;
  }

  .amad-action {
    background: #f9f9f9;
    padding: 16px;
    border-radius: 6px;
    box-shadow: 0 1px 4px rgba(0,0,0,0.1);
  }
</style>


<!-- Locker Studio iframe -->
<div class="iframe-wrapper">
  <iframe id="reportFrame"></iframe>
</div>

<!-- ‚úÖ Full Embedded DPI App -->
<div class="dpi-iframe-wrapper"
     style="width:100%; max-width:1000px; height:720px; margin:20px auto;
            border:1px solid var(--da-green); display:none; border-radius:6px; overflow:hidden;">

  <iframe id="dpiFrame"
          style="width:100%; height:100%; border:none;"
          srcdoc="
<!doctype html>
<html lang='en'>
<head>
<meta charset='utf-8'>
<meta name='viewport' content='width=device-width,initial-scale=1'>
<title>DA Price Report</title>

<link href='https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap' rel='stylesheet'>

<style>
:root { --da-green:#0b6623; --light-yellow:#ded371; }

body {
  font-family:Inter,Arial,sans-serif;
  background:#f0f4f7;
  margin:0; padding:10px;
  font-size:13px;
}

.controls {
  background:#fff;
  border-radius:6px;
  padding:10px 14px;
  margin-bottom:10px;
  box-shadow:0 2px 6px rgba(0,0,0,0.05);
}
@media print { .controls { display:none!important; } }

select,button {
  padding:6px 10px;
  border-radius:4px;
  border:1px solid #ccc;
  font-size:13px;
}
button {
  cursor:pointer;
  background:#0b6623;
  color:#fff;
  border:none;
  font-weight:600;
}
button:hover { background:#0a5820; }

.top-strip {background:var(--da-green);height:4px;width:100%;}
.yellow-strip {background:var(--light-yellow);height:4px;width:100%;}

.header {
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:10px 18px;
  background:#fff;
  margin-bottom:10px;
}
.left-block{display:flex;align-items:center;gap:10px;}
.left-block img{height:55px;}
.agency-text{font-size:12px;line-height:1.3;}
.agency-text strong{font-size:13px;display:block;color:var(--da-green);}

.price-monitoring {
  text-align:center;
  background:var(--light-yellow);
  padding:6px;
  font-size:16px;
  font-weight:700;
}
.sub-title {
  text-align:center;
  font-size:15px;
  font-weight:700;
  color:#333;
  margin:4px 0;
}
.asof {
  text-align:center;
  font-size:12px;
  font-style:italic;
  margin-bottom:6px;
}

.table-container {
  background:#fff;
  border-radius:6px;
  padding:8px;
}
table {
  width:100%;
  border-collapse:collapse;
}
th,td {
  border:1px solid #ddd;
  padding:4px 6px;
  font-size:13px;
}
th {
  background:#0b6623;
  color:#fff;
  text-align:left;
}

.notes { margin-top:6px;font-size:12px;color:#555; }
.error { color:#b91c1c; font-weight:600; }

.footer-logo {
  display:flex;
  justify-content:flex-end;
  padding:8px 20px 0 0;
}
.footer-logo img {
  height:65px;
}
footer {
  background:var(--da-green);
  color:white;
  padding:8px 16px;
  display:flex;
  align-items:center;
  justify-content:space-between;
  font-size:12px;
  margin-top:10px;
}
footer a {color:white;text-decoration:none;}
</style>
</head>

<body>
  <div class='controls'>
    <h3 style='margin:0 0 6px 0;font-size:14px;'>Agri-Fishery Commodity Retail Price</h3>
    <label style='font-size:12px;margin-right:6px;'>Select Date:</label>
    <select id='dateSelect'></select>
    <button id='loadBtn'>Load</button>
    <button id='downloadPdf'>Download PDF</button>
    <div id='notes' class='notes'></div>
  </div>

  <div id='reportArea'>
    <div class='top-strip'></div>
    <div class='yellow-strip'></div>

    <div class='header'>
      <div class='left-block'>
        <img src='https://raw.githubusercontent.com/amadnuevedpi/DA-AMAD-BP-logos/main/da.png' alt='DA Logo'>
        <div class='agency-text'>
          <strong>Department of Agriculture</strong>
          AGRIBUSINESS MARKETING ASSISTANCE DIVISION<br>
          Regional Field Office IX<br>
          Lenienza St., Pagadian City
        </div>
      </div>
      <img src='https://raw.githubusercontent.com/amadnuevedpi/DA-AMAD-BP-logos/main/bag%20pil.png' height='55' alt='Bagong Pilipinas'>
    </div>

    <div class='price-monitoring'>REGION IX AGRI-FISHERY AND CIGARETTES</div>
    <div class='sub-title'>DAILY PRICE INDEX REPORT</div>
    <div id='asOfDate' class='asof'>As of ‚Äî</div>

    <div class='table-container'>
      <table id='priceTable'>
        <thead>
          <tr><th>Commodity</th><th>Specification</th><th>Unit</th><th>Price</th></tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>

    <div class='footer-logo'>
      <img src='https://raw.githubusercontent.com/amadnuevedpi/DA-AMAD-BP-logos/main/ZAMPEN%20VINTA1.png' alt='Zampen Vinta'>
    </div>

    <footer>
      <div class='footer-left'>Generated by DA-AMAD Price Monitoring System</div>
      <div><a href='#'>Department of Agriculture RFO IX</a></div>
    </footer>
  </div>

<script>
const SHEET_CSV='https://docs.google.com/spreadsheets/d/e/2PACX-1vR2B1kT01540Rd4EIE1JmbBGoJVIF_N15yBJ815TaB_N8tViqufx1hksC9J-HcRcN8jvP2QLfl84yQr/pub?gid=1473969119&single=true&output=csv';

function showNote(msg,isErr=false){
  const el=document.getElementById('notes');
  el.innerHTML=(isErr?'<span class=error>Error:</span> ':'')+msg;
}

const papa=document.createElement('script');
papa.src='https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js';
papa.onload=init;
document.head.appendChild(papa);

let rows=[],headerRow=[],dateColumns=[];

function init(){
  showNote('Loading CSV...');
  fetch(SHEET_CSV,{cache:'no-store'})
    .then(r=>r.text())
    .then(txt=>{
      const parsed=Papa.parse(txt,{skipEmptyLines:false});
      rows=parsed.data;
      headerRow=rows[9]||[];
      identifyDates();
    })
    .catch(e=>showNote(e.message,true));
}

function parseDateISO(t){
  if(!t)return null;
  const s=String(t).trim();
  const d=new Date(s);
  if(!isNaN(d))return d.toISOString().slice(0,10);

  const m=s.match(/^([A-Za-z]+)\\s+(\\d{1,2}),\\s*(\\d{4})$/);
  if(m){
    const months=['January','February','March','April','May','June','July','August','September','October','November','December'];
    const i=months.indexOf(m[1]);
    if(i>=0)return new Date(Date.UTC(m[3],i,m[2])).toISOString().slice(0,10);
  }

  const n=Number(s);
  if(!isNaN(n)&&n>10000){
    const base=new Date(Date.UTC(1899,11,30));
    return new Date(base.getTime()+n*86400000).toISOString().slice(0,10);
  }
  return null;
}

function identifyDates(){
  dateColumns=[];
  for(let i=3;i<headerRow.length;i++){
    const iso=parseDateISO(headerRow[i]);
    if(iso)dateColumns.push({index:i,iso,label:headerRow[i]});
  }
  if(dateColumns.length===0)return showNote('‚ö†Ô∏è No valid date columns found.',true);

  const sel=document.getElementById('dateSelect');
  sel.innerHTML=dateColumns.map(dc=>`<option value='${dc.index}'>${dc.label}</option>`).join('');
  sel.value=dateColumns.at(-1).index;

  document.getElementById('loadBtn').addEventListener('click',()=>{
    const idx=Number(sel.value);
    const dc=dateColumns.find(d=>d.index===idx);
    renderByColumn(idx);
    document.getElementById('asOfDate').innerText=\`As of \${dc?dc.label:''}\`;
  });

  document.getElementById('downloadPdf').addEventListener('click',downloadPDF);
  document.getElementById('loadBtn').click();
}

function renderByColumn(i){
  const tb=document.querySelector('#priceTable tbody');
  tb.innerHTML='';
  let c=0;
  for(let r=10;r<rows.length;r++){
    const row=rows[r];
    if(!row||row.length<=i)continue;
    const com=row[0]||'',spec=row[1]||'',unit=row[2]||'',price=row[i]||'';
    if(com.trim()){
      tb.insertAdjacentHTML('beforeend',\`<tr><td>\${com}</td><td>\${spec}</td><td>\${unit}</td><td>\${price}</td></tr>\`);
      c++;
    }
  }
  showNote(\`‚úÖ Showing \${c} records for: \${headerRow[i]}\`);
}

function downloadPDF(){
  const area=document.getElementById('reportArea');
  if(!window.html2pdf){
    const s=document.createElement('script');
    s.src='https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.3/html2pdf.bundle.min.js';
    s.onload=()=>generatePDF(area);
    document.body.appendChild(s);
  } else generatePDF(area);
}

function generatePDF(area){
  html2pdf().set({
    margin:5,
    filename:\`DA-Price-Report-\${new Date().toISOString().slice(0,10)}.pdf\`,
    pagebreak:{mode:['avoid-all','css','legacy']}
  }).from(area).save();
}
</script>
</body>
</html>
"></iframe>
</div>

  <div class="footer-logo">
    <img src="https://raw.githubusercontent.com/amadnuevedpi/DA-AMAD-BP-logos/main/ZAMPEN%20VINTA1.png" alt="AMAD ZamPen Logo">
  </div>

  <div class="yellow-strip"></div>

  <footer>
    <div class="footer-left">
      <a href="https://www.facebook.com/amadrfo9" target="_blank" rel="noopener">Facebook: AMAD RFO IX</a>
      <a href="mailto:amadnueve@gmail.com">Email: amadnueve@gmail.com</a>
    </div>
  </footer>

  <script>
    function toggleSubmenu(evt) {
      evt.stopPropagation();
      const btn = evt.currentTarget;
      const submenu = document.getElementById('submenu');
      const navbar = document.querySelector('.navbar');

      if (submenu.style.display === 'block') {
        submenu.style.display = 'none';
        submenu.setAttribute('aria-hidden','true');
        return;
      }
      const btnRect = btn.getBoundingClientRect();
      const navRect = navbar.getBoundingClientRect();
      const left = btnRect.left - navRect.left;
      const top = btnRect.bottom - navRect.top + 6;
      submenu.style.left = left + 'px';
      submenu.style.top = top + 'px';
      submenu.style.display = 'block';
      submenu.setAttribute('aria-hidden','false');
    }

    function loadReport(url) {
  const iframeWrapper = document.querySelector(".iframe-wrapper");       // Locker Studio
  const dpiWrapper = document.querySelector(".dpi-iframe-wrapper");      // DPI iframe
  const homeContent = document.getElementById("homeContent");

  // Always hide DPI iframe & home content first
  dpiWrapper.style.display = "none";
  homeContent.style.display = "none";

  if (url === "") {
    // Show home if empty
    iframeWrapper.style.display = "none";
    homeContent.style.display = "block";
  } else {
    // Show Locker Studio iframe
    iframeWrapper.style.display = "block";
    document.getElementById("reportFrame").src = url;
  }

  // Hide submenu if open
  const submenu = document.getElementById('submenu');
  submenu.style.display = 'none';
  submenu.setAttribute('aria-hidden','true');
}

function loadDPI(url) {
  const iframeWrapper = document.querySelector(".dpi-iframe-wrapper");
  const homeContent = document.getElementById("homeContent");

  iframeWrapper.style.display = "block";
  homeContent.style.display = "none";

  // Hide submenu
  const submenu = document.getElementById("submenu");
  submenu.style.display = "none";
  submenu.setAttribute("aria-hidden", "true");
}



    function setActive(button) {
      document.querySelectorAll('.navbar button').forEach(btn => btn.classList.remove('active'));
      document.querySelectorAll('.submenu button').forEach(btn => btn.classList.remove('active'));
      button.classList.add('active');
    }

    function setSubActive(button) {
      document.querySelectorAll('.navbar button').forEach(btn => btn.classList.remove('active'));
      document.querySelectorAll('.submenu button').forEach(btn => btn.classList.remove('active'));
      button.classList.add('active');
    }

    window.addEventListener('click', function(e){
      const submenu = document.getElementById('submenu');
      if (submenu && submenu.style.display === 'block') {
        const priceBtn = document.getElementById('priceStatsBtn');
        if (!priceBtn.contains(e.target) && !submenu.contains(e.target)) {
          submenu.style.display = 'none';
          submenu.setAttribute('aria-hidden','true');
        }
      }
    });

   

    // ‚úÖ Save + Restore active section state
    document.addEventListener("DOMContentLoaded", function() {
      const downloadBtn = document.getElementById("downloadDPI");
      const dpiFrame   = document.getElementById("dpiFrame");
      const dpiWrapper = document.querySelector(".dpi-iframe-wrapper");
      const iframeWrapper = document.querySelector(".iframe-wrapper");
      const homeContent   = document.getElementById("homeContent");

      const webAppUrl = "https://script.google.com/macros/s/AKfycbxop8MCXokYSXKXnbX8tu0BiG0Ci9Zo1zcrxky3EKkFP4NpQQQvdV4LqNCgQtIVwRUcJA/exec";

      // ‚¨áÔ∏è Restore last active section on reload
      const lastState = localStorage.getItem("activeSection");
      if (lastState === "dpi") {
        homeContent.style.display = "none";
        iframeWrapper.style.display = "none";
        dpiWrapper.style.display = "block";

        const lastUrl = localStorage.getItem("dpiFrameUrl");
        if (lastUrl && dpiFrame) dpiFrame.src = lastUrl;
      } else if (lastState === "report") {
        homeContent.style.display = "none";
        dpiWrapper.style.display = "none";
        iframeWrapper.style.display = "block";

        const lastUrl = localStorage.getItem("reportFrameUrl");
        if (lastUrl) document.getElementById("reportFrame").src = lastUrl;
      } else {
        // Default ‚Üí Home
        homeContent.style.display = "block";
        iframeWrapper.style.display = "none";
        dpiWrapper.style.display = "none";
      }

      // ‚¨áÔ∏è Save state when clicking DPI Download
      if (downloadBtn) {
        downloadBtn.addEventListener("click", function() {
          if (dpiFrame && dpiFrame.src) {
            localStorage.setItem("dpiFrameUrl", dpiFrame.src);
          }
          localStorage.setItem("activeSection", "dpi");
          window.open(webAppUrl, "_blank", "noopener");
        });
      }
    });
  </script>
</body>
</html>
